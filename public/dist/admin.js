(()=>{var u=(()=>{let m='<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>',p=f=>String(f).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),g=(f,o)=>(f.replaceChildren(document.createRange().createContextualFragment(o)),f),r=(f,o,v=.05)=>new Promise(B=>{let i=parseFloat(f.style.opacity),x=o?1:0,L=()=>{i+=o?v:-v,i=Math.max(0,Math.min(1,i)),f.style.opacity=i.toFixed(2),o&&i>=x||!o&&i<=x?(f.style.opacity=x.toString(),B(f)):requestAnimationFrame(L)};requestAnimationFrame(L)}),c=(f,o)=>{let v=null;v=setTimeout(()=>{f(),clearTimeout(v),v=null},o)};return{loader:m,copy:async(f,o=null,v=1500)=>{let B=f.getAttribute("data-copy");if(!B||B.length===0){alert("Nothing to copy");return}f.disabled=!0;try{await navigator.clipboard.writeText(B)}catch{f.disabled=!1,alert("Failed to copy");return}let i=f.innerHTML;g(f,o||'<i class="fa-solid fa-check"></i>'),c(()=>{f.disabled=!1,f.innerHTML=i},v)},timeOut:c,debounce:(f,o)=>{let v=null;return(...B)=>{clearTimeout(v),v=setTimeout(()=>f(...B),o)}},escapeHtml:p,base64Encode:f=>{let v=new TextEncoder().encode(f);return window.btoa(String.fromCharCode(...v))},base64Decode:f=>{let o=new TextDecoder,v=Uint8Array.from(window.atob(f),B=>B.charCodeAt(0));return o.decode(v)},disableButton:(f,o="Loading",v=!1)=>{f.disabled=!0;let B=f.innerHTML;return g(f,v?o:m+o),{restore:(i=!1)=>{f.innerHTML=B,f.disabled=i}}},disableCheckbox:f=>{f.disabled=!0;let o=document.querySelector(`label[for="${f.id}"]`),v=o.innerHTML;return g(o,m+v),{restore:()=>{o.innerHTML=v,f.disabled=!1}}},safeInnerHTML:g,parseUserAgent:f=>{let o=[{type:"Mobile",regex:/Android.*Mobile|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)|Tablet/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],v=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],B=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],i=o.find(l=>l.regex.test(f))?.type||"Unknown",x=v.find(l=>l.regex.test(f))?.name||"Unknown",L=B.find(l=>l.regex.test(f)),U=L&&f.match(L.regex)?.[1]?.replace(/_/g,".")||"",q=L?L.name:"Unknown";return U=U?`${q} ${U}`:q,`${x} ${i} ${U}`},changeOpacity:r}})();var ee={tab:g=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(g)),modal:g=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(g))};var D=(()=>{let m=(o,v,B)=>({code:o,data:v,error:B}),p=(o=0)=>({love:o}),g=({uuid:o,own:v,name:B,presence:i,comment:x,created_at:L,is_admin:U,gif_url:q,ip:l,user_agent:t,comments:e,like:d})=>({uuid:o,own:v,name:B,presence:i,comment:x,created_at:L,is_admin:U??!1,gif_url:q,ip:l,user_agent:t,comments:e?.map(g)??[],like:p(d?.love??0)}),r=o=>o.map(g);return{uuidResponse:({uuid:o})=>({uuid:o}),baseResponse:m,tokenResponse:({token:o})=>({token:o}),statusResponse:({status:o})=>({status:o}),commentResponse:({name:o,presence:v,comment:B,is_admin:i,gif_url:x,created_at:L})=>({name:o,presence:v,comment:B,is_admin:i,gif_url:x,created_at:L}),likeCommentResponse:p,getCommentResponse:g,getCommentsResponse:r,getCommentsResponseV2:o=>({count:o.count,lists:r(o.lists)}),commentShowMore:(o,v=!1)=>({uuid:o,show:v}),postCommentRequest:(o,v,B,i,x)=>({id:o,name:v,presence:B,comment:i,gif_id:x}),postSessionRequest:(o,v)=>({email:o,password:v}),updateCommentRequest:(o,v,B)=>({presence:o,comment:v,gif_id:B})}})();var H=m=>{let p=(T=null)=>{let E=JSON.parse(localStorage.getItem(m));return T?E[String(T)]:E},g=(T,E)=>{let n=p();n[String(T)]=E,localStorage.setItem(m,JSON.stringify(n))},r=T=>Object.keys(p()).includes(String(T)),c=T=>{if(!r(T))return;let E=p();delete E[String(T)],localStorage.setItem(m,JSON.stringify(E))},b=()=>localStorage.setItem(m,"{}");return localStorage.getItem(m)||b(),{set:g,get:p,has:r,clear:b,unset:c}};var j="GET",te="PUT",Q="POST",K="PATCH",ie="DELETE",W=200,ne=201,ge=500,Y={Accept:"application/json","Content-Type":"application/json"},P=(m,p)=>{let g=new AbortController,r={signal:g.signal,method:String(m).toUpperCase(),headers:new Headers(Y)};window.addEventListener("offline",()=>g.abort()),window.addEventListener("popstate",()=>g.abort());let c=0,b=1e3,T=0,E=document.body.getAttribute("data-url");return E&&E.slice(-1)==="/"&&(E=E.slice(0,-1)),{send(n=null){return fetch(E+p,r).then(h=>h.json().then(w=>{if(h.status>=ge&&(w.message??w[0]))throw new Error(w.message??w[0]);if(w.error)throw new Error(w.error[0]);return n&&(w.data=n(w.data)),D.baseResponse(w.code,w.data,w.error)})).catch(h=>{if(h.name==="AbortError")return console.warn("Fetch abort:",h),h;throw alert(h),new Error(h)})},withRetry(n=3,h=1e3){return c=n,b=h,this},withCancel(n){return n==null?this:((async()=>(await n,g.abort()))(),this)},default(n=null){if(r.headers=new Headers(n??{}),c===0&&b===0)return fetch(p,r);let h=async()=>{try{let w=await fetch(p,r);if(!w.ok)throw new Error(`HTTP error! Status: ${w.status}`);return w}catch(w){if(w.name==="AbortError")throw w;if(b*=2,T++,T>=c)throw new Error(`Max retries reached: ${w}`);return console.warn(`Retrying fetch (${T}/${c}): ${p}`),await new Promise(y=>u.timeOut(y,b)),h()}};return h()},download(){return Object.keys(Y).forEach(n=>r.headers.delete(n)),fetch(E+p,r).then(n=>{if(n.status!==W)return!1;let h=document.querySelector("a[download]");h&&document.body.removeChild(h);let w=n.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return n.blob().then(y=>{let f=document.createElement("a"),o=window.URL.createObjectURL(y);return f.href=o,f.download=w,document.body.appendChild(f),f.click(),document.body.removeChild(f),window.URL.revokeObjectURL(o),!0})}).catch(n=>{if(n.name==="AbortError")return console.warn("Fetch abort:",n),n;throw alert(n),new Error(n)})},token(n){return n.split(".").length===3?(r.headers.append("Authorization","Bearer "+n),this):(r.headers.append("x-access-key",n),this)},body(n){return r.body=JSON.stringify(n),this}}};var S=(()=>{let m=null,p=()=>m.get("token"),g=h=>m.set("token",h),r=h=>P(Q,"/api/session").body(h).send(D.tokenResponse).then(w=>(w.code===W&&g(w.data.token),w.code===W),()=>!1),c=()=>m.unset("token"),b=()=>String(p()??".").split(".").length===3;return{init:()=>{m=H("session")},guest:()=>P(j,"/api/v2/config").token(p()).send().then(h=>{if(h.code!==W)throw new Error("failed to get config.");let w=H("config");for(let[y,f]of Object.entries(h.data))w.set(y,f);return h}),login:r,logout:c,decode:()=>{if(!b())return null;try{return JSON.parse(u.base64Decode(p().split(".")[1]))}catch{return null}},isAdmin:b,setToken:g,getToken:p}})();var Z=(()=>{let m=null,p=async T=>{let E=u.disableButton(T),n=document.getElementById("loginEmail"),h=document.getElementById("loginPassword");n.disabled=!0,h.disabled=!0,await S.login(D.postSessionRequest(n.value,h.value))&&(n.value=null,h.value=null,ee.modal("mainModal").hide()),E.restore(),n.disabled=!1,h.disabled=!1},g=()=>{m.clear(),S.logout(),ee.modal("mainModal").show()};return{init:()=>{m=H("user")},login:p,clearSession:g,getDetailUser:()=>P(j,"/api/user").token(S.getToken()).send().then(T=>{if(T.code!==W)throw new Error("failed to get user.");return Object.entries(T.data).forEach(([E,n])=>m.set(E,n)),T},T=>(g(),T)),getUserStorage:()=>m}})();var le=(()=>{let m=(r,c)=>{document.querySelectorAll(".navbar button").forEach(b=>{b.classList.contains("active")&&b.classList.remove("active")}),ee.tab(c).show(),r.classList.add("active")};return{buttonNavHome:r=>{m(r,"button-home")},buttonNavSetting:r=>{m(r,"button-setting")}}})();var oe=(()=>{let m={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},p=["#ffffff","#f8f9fa"],g=["#000000","#212529"],r=!1,c=null,b=null,T=()=>c.set("active","light"),E=()=>c.set("active","dark"),n=i=>{let x=b.getAttribute("content");b.setAttribute("content",i.some(L=>L===x)?m[x]:x)},h=()=>{T(),document.documentElement.setAttribute("data-bs-theme","light"),n(g)},w=()=>{E(),document.documentElement.setAttribute("data-bs-theme","dark"),n(p)},y=(i=null,x=null)=>{let L=c.get("active")==="dark";return i&&x?L?i:x:L};return{init:()=>{switch(c=H("theme"),b=document.querySelector('meta[name="theme-color"]'),c.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?E():T()),document.documentElement.getAttribute("data-bs-theme")){case"dark":E();break;case"light":T();break;default:r=!0}y()?w():h()},spyTop:()=>{let i=L=>L.filter(U=>U.isIntersecting).forEach(U=>{let q=U.target.classList.contains("bg-white-black")?y(g[0],p[0]):y(g[1],p[1]);b.setAttribute("content",q)}),x=new IntersectionObserver(i,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(L=>x.observe(L))},change:()=>y()?h():w(),isDarkMode:y,isAutoMode:()=>r}})();var J=(()=>{let m={id:"ID",en:"US",fr:"FR",de:"DE",es:"ES",zh:"CN",ja:"JP",ko:"KR",ar:"SA",ru:"RU",it:"IT",nl:"NL",pt:"PT",tr:"TR",th:"TH",vi:"VN",ms:"MY",hi:"IN"},p=null,g=null,r=null,c=null;return{on(b,T){return c.set(b,T),this},get(){let b=c.get(r);return c.clear(),b},getCountry(){return p},getLocale(){return g},getLanguage(){return r},setDefault(b){let T=!0;m[b]||(T=!1,console.warn("Language not found, please add manually in countryMapping")),p=T?m[b]:"US",r=T?b:"en",g=`${r}_${p}`},init(){c=new Map,this.setDefault(navigator.language.split("-").shift())}}})();var ce=(()=>{let m=null,p=!0,g=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"],r=()=>p,c=()=>{let y=m.firstElementChild.firstElementChild;y.classList.remove("bg-success"),y.classList.add("bg-danger"),y.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},b=()=>{let y=m.firstElementChild.firstElementChild;y.classList.remove("bg-danger"),y.classList.add("bg-success"),y.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},T=async()=>{p&&(await u.changeOpacity(m,!1),c())},E=()=>{document.querySelectorAll(g.join(", ")).forEach(y=>{y.dispatchEvent(new Event(r()?"online":"offline")),y.setAttribute("data-offline-disabled",r()?"false":"true"),y.tagName==="BUTTON"?r()?y.classList.remove("disabled"):y.classList.add("disabled"):r()?y.removeAttribute("disabled"):y.setAttribute("disabled","true")})},n=()=>{p=!1,c(),u.changeOpacity(m,!0),E()},h=()=>{p=!0,b(),u.timeOut(T,3e3),E()};return{init:()=>{window.addEventListener("online",h),window.addEventListener("offline",n),m=document.createElement("div"),m.classList.add("fixed-top","pe-none"),m.style.cssText="opacity: 0; z-index: 1057;",m.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`,document.body.insertBefore(m,document.body.lastChild)},isOnline:r}})();var de=m=>{let p=new Map,g=new Map,r=null,c=1e3*60*60*6,b=async()=>{!r&&window.isSecureContext&&(r=await window.caches.open(m))},T=(n,h=null)=>{if(p.has(n))return Promise.resolve(p.get(n));if(g.has(n))return g.get(n);let w=b().then(()=>{let y=()=>P(j,n).withCancel(h).withRetry().default().then(o=>o.blob().then(v=>{if(!window.isSecureContext)return v;let B=new Headers,i=new Date(Date.now()+c);return B.set("Content-Length",String(v.size)),B.set("Expires",i.toUTCString()),B.set("Content-Type",o.headers.get("Content-Type")),r.put(n,new Response(v,{headers:B})).then(()=>v.slice())})),f=o=>(p.set(n,URL.createObjectURL(o)),p.get(n));return window.isSecureContext?r.match(n).then(o=>{if(!o)return y();let v=o.headers.get("Expires"),B=v?new Date(v).getTime():0;return Date.now()>B?r.delete(n).then(i=>i?y():o.blob()):o.blob()}).then(o=>f(o)):y().then(o=>f(o))}).finally(()=>{g.delete(n)});return g.set(n,w),w};return{run:async(n,h=null)=>{await b();let w=new Map;return window.isSecureContext||console.warn("Cache is not supported in insecure context"),n.filter(y=>y!==null).forEach(y=>{w.set(y.url,[...w.get(y.url)??[],[y.res,y?.rej]])}),Promise.allSettled(Array.from(w).map(([y,f])=>T(y,h).then(o=>(f.forEach(v=>v[0]?.(o)),o)).catch(o=>(f.forEach(v=>v[1]?.(o)),o))))},get:T,open:b,setTtl(n){return c=Number(n),this}}};var O=(()=>{let m="gifs",p="default",g={128:2,256:3,512:4,768:5},r=null,c=null,b=null,T=null,E=(s,a,k)=>{let _=c.get(s);return a.map(M=>{let{id:I,media_formats:{tinygif:{url:N}},content_description:F}=M;_.pointer===-1||_.pointer===_.col-1?_.pointer=0:_.pointer++;let R=0;for(let re of _.lists.childNodes){if(R===_.pointer)return{url:N,res:ae=>{re.insertAdjacentHTML("beforeend",`
                        <figure class="gif-figure m-0 position-relative">
                            <button onclick="undangan.comment.gif.click(this, '${_.uuid}', '${I}', '${u.base64Encode(N)}')" class="btn gif-checklist position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-1 m-1 rounded-circle border shadow-sm z-1">
                                <i class="fa-solid fa-circle-check"></i>
                            </button>
                            <img src="${ae}" class="img-fluid" alt="${u.escapeHtml(F)}" style="width: 100%;">
                        </figure>`),k.step()}};R++}return null})},n=()=>r.open(),h=s=>r.get(s),w=s=>{let a=c.get(s),k=a.lists,_=document.getElementById(`gif-loading-${a.uuid}`),M=document.getElementById(`progress-bar-${a.uuid}`),I=document.getElementById(`progress-info-${a.uuid}`),N=0,F=0;return k.classList.contains("d-none")||_.classList.replace("d-none","d-flex"),I.innerText=`${F}/${N}`,k.setAttribute("data-continue","false"),k.classList.replace("overflow-y-scroll","overflow-y-hidden"),{release:()=>{k.classList.contains("d-none")||_.classList.replace("d-flex","d-none"),M.style.width="0%",I.innerText=`${F}/${N}`,k.setAttribute("data-continue","true"),k.classList.replace("overflow-y-hidden","overflow-y-scroll")},until:ae=>{N=ae,I.innerText=`${F}/${N}`},step:()=>{F+=1,I.innerText=`${F}/${N}`,M.style.width=Math.min(F/N*100,100).toString()+"%"}}},y=(s,a,k)=>{k={media_filter:"tinygif",client_key:"undangan_app",key:T.get("tenor_key"),country:J.getCountry(),locale:J.getLocale(),...k??{}};let _=Object.keys(k).filter(R=>k[R]!==null&&k[R]!==void 0).map(R=>`${R}=${encodeURIComponent(k[R])}`).join("&"),M=w(s),I=c.get(s),N=new Promise(R=>{I.reqs.push(R)}),F=`https://tenor.googleapis.com/v2${a}?${_}`;I.last=P(j,F).withCancel(N).default(Y).then(R=>R.json()).then(R=>{if(R.error)throw new Error(R.error.message);return R.results.length===0?R:(I.next=R?.next,M.until(R.results.length),I.gifs.push(...R.results),r.run(E(s,R.results,M),N))}).catch(R=>{R.name==="AbortError"?console.warn("Fetch abort:",R):alert(R)}).finally(()=>M.release())},f=s=>(s=u.escapeHtml(s),`
        <label for="gif-search-${s}" class="form-label my-1"><i class="fa-solid fa-photo-film me-2"></i>Gif</label>

        <div class="d-flex mb-3" id="gif-search-nav-${s}">
            <button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1" onclick="undangan.comment.gif.back(this, '${s}')" data-offline-disabled="false"><i class="fa-solid fa-arrow-left"></i></button>
            <input type="text" name="gif-search" id="gif-search-${s}" autocomplete="on" class="form-control shadow-sm rounded-4" placeholder="Search for a GIF on Tenor" data-offline-disabled="false">
        </div>

        <div class="position-relative">
            <div class="position-absolute d-flex flex-column justify-content-center align-items-center top-50 start-50 translate-middle w-100 h-100 bg-overlay-auto rounded-4 z-3" id="gif-loading-${s}">
                <div class="progress w-25" role="progressbar" style="height: 0.5rem;" aria-label="progress bar">
                    <div class="progress-bar" id="progress-bar-${s}" style="width: 0%"></div>
                </div>
                <small class="mt-1 text-theme-auto bg-theme-auto py-0 px-2 rounded-4" id="progress-info-${s}" style="font-size: 0.7rem;"></small>
            </div>
            <div id="gif-lists-${s}" class="d-flex rounded-4 p-0 overflow-y-scroll border" data-continue="true" style="height: 15rem;"></div>
        </div>

        <figure class="d-flex m-0 position-relative" id="gif-result-${s}">
            <button onclick="undangan.comment.gif.cancel('${s}')" id="gif-cancel-${s}" class="btn d-none position-absolute justify-content-center align-items-center top-0 end-0 bg-overlay-auto p-2 m-1 rounded-circle border shadow-sm z-1">
                <i class="fa-solid fa-circle-xmark"></i>
            </button>
        </figure>`),o=async s=>{let a=c.get(s);a.reqs.forEach(k=>k()),a.reqs.length=0,a.last&&(await a.last,a.last=null)},v=async s=>{await o(s);let a=c.get(s),k=a.col??0,_=0;for(let[I,N]of Object.entries(g))_=N,a.lists.clientWidth>=parseInt(I)&&(a.col=_);if(a.col===null&&(a.col=_),k===a.col||(a.pointer=-1,a.limit=a.col*5,a.lists.innerHTML='<div class="d-flex flex-column"></div>'.repeat(a.col),a.gifs.length===0))return;let M=w(s);M.until(a.gifs.length);try{await r.run(E(s,a.gifs,M))}catch{a.gifs.length=0}k!==a.col&&a.lists.scroll({top:a.lists.scrollHeight,behavior:"instant"}),M.release(),a.gifs.length===0&&await v(s)},B=async s=>{let a=c.get(s);if(a.lists.getAttribute("data-continue")!=="true"||!a.next||a.next.length===0)return;let k=a.query&&a.query.trim().length>0,_={pos:a.next,limit:a.limit};k&&(_.q=a.query),a.lists.scrollTop>(a.lists.scrollHeight-a.lists.clientHeight)*.8&&(await v(s),y(s,k?"/search":"/featured",_))},i=async(s,a=null)=>{let k=c.get(s);k.query=a!==null?a:k.query,(!k.query||k.query.trim().length===0)&&(k.query=null),k.col=null,k.next=null,k.pointer=-1,k.gifs.length=0,await v(s),y(s,k.query===null?"/featured":"/search",{q:k.query,limit:k.limit})};return{default:p,init:()=>{c=new Map,b=new Map,r=de(m),T=H("config"),T.get("tenor_key")===null&&document.querySelector('[onclick="undangan.comment.gif.open(undangan.comment.gif.default)"]')?.remove()},get:h,back:async(s,a)=>{let k=u.disableButton(s,u.loader.replace("me-1","me-0"),!0);await o(a),k.restore(),document.getElementById(`gif-form-${a}`).classList.toggle("d-none",!0),document.getElementById(`comment-form-${a}`)?.classList.toggle("d-none",!1)},open:s=>{if(!c.has(s)){u.safeInnerHTML(document.getElementById(`gif-form-${s}`),f(s));let a=document.getElementById(`gif-lists-${s}`);c.set(s,{uuid:s,lists:a,last:null,limit:null,query:null,next:null,col:null,pointer:-1,gifs:[],reqs:[]});let k=u.debounce(B,150);a.addEventListener("scroll",()=>k(s));let _=u.debounce(i,850);document.getElementById(`gif-search-${s}`).addEventListener("input",M=>_(s,M.target.value))}return document.getElementById(`gif-form-${s}`).classList.toggle("d-none",!1),document.getElementById(`comment-form-${s}`)?.classList.toggle("d-none",!0),b.has(s)&&b.get(s)(),i(s)},cancel:s=>{let a=document.getElementById(`gif-result-${s}`);a.removeAttribute("data-id"),a.querySelector(`#gif-cancel-${s}`).classList.replace("d-flex","d-none"),a.querySelector("img").remove(),c.get(s).lists.classList.replace("d-none","d-flex"),document.getElementById(`gif-search-nav-${s}`).classList.replace("d-none","d-flex")},click:async(s,a,k,_)=>{let M=u.disableButton(s,u.loader.replace("me-1","me-0"),!0),I=document.getElementById(`gif-result-${a}`);I.setAttribute("data-id",k),I.querySelector(`#gif-cancel-${a}`).classList.replace("d-none","d-flex"),I.insertAdjacentHTML("beforeend",`<img src="${await r.get(u.base64Decode(_))}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">`),M.restore(),c.get(a).lists.classList.replace("d-flex","d-none"),document.getElementById(`gif-search-nav-${a}`).classList.replace("d-flex","d-none")},remove:async(s=null)=>{s?c.has(s)&&(await o(s),b.delete(s),c.delete(s)):(await Promise.all(Array.from(c.keys()).map(a=>o(a))),b.clear(),c.clear())},isOpen:s=>{let a=document.getElementById(`gif-form-${s}`);return a===null?!1:!a.classList.contains("d-none")},onOpen:(s,a)=>b.set(s,a),getResultId:s=>document.getElementById(`gif-result-${s}`)?.getAttribute("data-id"),buttonCancel:(s=null)=>{let a=document.getElementById(`gif-cancel-${s||p}`);return{show:()=>a.classList.replace("d-none","d-flex"),hide:()=>a.classList.replace("d-flex","d-none"),click:()=>a.dispatchEvent(new Event("click"))}},removeGifSearch:s=>document.querySelector(`[for="gif-search-${s}"]`)?.remove(),removeButtonBack:s=>document.querySelector(`[onclick="undangan.comment.gif.back(this, '${s}')"]`)?.remove(),prepareCache:n}})();var G=(()=>{let m=null,p=null,g=null,r=null,c=null,b=300,T=[["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']],E=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,n=e=>(T.forEach(d=>{let $=d[0],A=d[1];e=e.replace(new RegExp(`\\${$}(?=\\S)(.*?)(?<!\\s)\\${$}`,"gs"),A)}),e),h=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.love(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${p.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,w=e=>{let d=`<div class="d-flex justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(g.get("can_reply")===!0||g.get("can_reply")===void 0)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),m.has(e.uuid)&&(g.get("can_edit")===!0||g.get("can_edit")===void 0)&&!(e.gif_url&&g.get("tenor_key")===null)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),S.isAdmin()?d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:m.has(e.uuid)&&(g.get("can_delete")===!0||g.get("can_delete")===void 0)&&(d+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),d+="</div>",d},y=(e,d)=>{e=u.escapeHtml(e);let $=c.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${u.escapeHtml(d.join(","))}" data-show="${$?"true":"false"}" role="button" class="me-auto ms-1 py-0">${$?"Hide replies":`Show replies (${d.length})`}</a>`},f=e=>`
        <div class="d-flex justify-content-between align-items-center" id="button-${e.uuid}">
            ${w(e)}
            ${e.comments.length>0?y(e.uuid,e.comments.map(d=>d.uuid)):""}
            ${h(e)}
        </div>`,o=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${u.escapeHtml(e.ip)} ${r.has(e.ip)?`<strong>${r.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${u.parseUserAgent(u.escapeHtml(e.user_agent))}</p>
        </div>`,v=(e,d)=>d?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${c.get("hidden").find($=>$.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,B=(e,d)=>e.is_admin?`<strong class="me-1">${u.escapeHtml(e.name)}</strong><i class="fa-solid fa-certificate text-primary"></i>`:d?`<strong class="me-1">${u.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" data-is-presence="${e.presence?"true":"false"}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${u.escapeHtml(e.name)}</strong>`,i=async(e,d)=>{let $=`
        <div class="d-flex justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${B(e,d)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">`;if(e.gif_url)return $+`
            <div class="d-flex justify-content-center align-items-center my-2">
                <img src="${await O.get(e.gif_url)}" id="img-gif-${e.uuid}" class="img-fluid mx-auto gif-image rounded-4" alt="selected-gif">
            </div>`;let A=n(u.escapeHtml(e.comment)),C=A.length>b;return $+`
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${C?`data-comment="${u.base64Encode(A)}"`:""} id="content-${e.uuid}">${C?A.slice(0,b)+"...":A}</p>
        ${C?`<p class="d-block mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},x=async(e,d=!1)=>{let $=await i(e,d),A=await Promise.all(e.comments.map(C=>x(C)));return`
        <div ${v(e,d)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">${$}</div>
            ${o(e)}
            ${f(e)}
            <div id="reply-content-${e.uuid}">${A.join("")}</div>
        </div>`};return{init:()=>{m=H("owns"),p=H("likes"),g=H("config"),r=H("tracker"),c=H("comment")},renderEdit:(e,d,$,A)=>{e=u.escapeHtml(e);let C=document.createElement("div");C.classList.add("my-2"),C.id=`inner-${e}`;let z=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</p>
        ${$?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${d?"selected":""}>&#9989; Datang</option>
            <option value="2" ${d?"":"selected"}>&#10060; Berhalangan</option>
        </select>`:""}
        ${A?`${g.get("tenor_key")===null?"":`<div class="d-none mb-2" id="gif-form-${e}"></div>`}`:`<textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>    
        `}
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`;return u.safeInnerHTML(C,z)},renderReply:e=>{e=u.escapeHtml(e);let d=document.createElement("div");d.classList.add("my-2"),d.id=`inner-${e}`;let $=`
        <p class="my-1 mx-0 p-0" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</p>
        <div class="d-block mb-2" id="comment-form-${e}">
            <div class="position-relative">
                ${g.get("tenor_key")===null?"":`<button class="btn btn-secondary btn-sm rounded-4 shadow-sm me-1 my-1 position-absolute bottom-0 end-0" onclick="undangan.comment.gif.open('${e}')" aria-label="button gif" data-offline-disabled="false"><i class="fa-solid fa-photo-film"></i></button>`}
                <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
            </div>
        </div>
        <div class="d-none mb-2" id="gif-form-${e}"></div>
        <div class="d-flex justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel(this, '${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`;return u.safeInnerHTML(d,$)},renderLoading:E,renderReadMore:y,renderContentMany:e=>O.prepareCache().then(()=>Promise.all(e.map(d=>x(d,!0)))).then(d=>d.join("")),renderContentSingle:e=>O.prepareCache().then(()=>x(e)),convertMarkdownToHTML:n,maxCommentLength:b}})();var pe=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var me=m=>{if(!window.confetti)return;let p=Date.now()+25,g=Math.max(.3,Math.min(1,m.getBoundingClientRect().top/window.innerHeight+.2)),r=pe(),c=["#FF69B4","#FF1493"],b=()=>{c.forEach(T=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[r],origin:{x:0,y:g},zIndex:1057,colors:[T]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[r],origin:{x:1,y:g},zIndex:1057,colors:[T]})}),Date.now()<p&&requestAnimationFrame(b)};requestAnimationFrame(b)};var X=(()=>{let m=null,p=null,g=async n=>{let h=n.firstElementChild,w=n.lastElementChild,y=n.getAttribute("data-uuid"),f=parseInt(h.getAttribute("data-count-like"));n.disabled=!0,navigator.vibrate&&navigator.vibrate(100),m.has(y)?await P(K,"/api/comment/"+m.get(y)).token(S.getToken()).send(D.statusResponse).then(o=>{o.data.status&&(m.unset(y),w.classList.remove("fa-solid","text-danger"),w.classList.add("fa-regular"),h.setAttribute("data-count-like",String(f-1)))}):await P(Q,"/api/comment/"+y).token(S.getToken()).send(D.uuidResponse).then(o=>{o.code===ne&&(m.set(y,o.data.uuid),w.classList.remove("fa-regular"),w.classList.add("fa-solid","text-danger"),h.setAttribute("data-count-like",String(f+1)))}),h.innerText=h.getAttribute("data-count-like"),n.disabled=!1},r=n=>document.querySelector(`button[onclick="undangan.comment.like.love(this)"][data-uuid="${n}"]`),c=async n=>{if(!navigator.onLine)return;let h=Date.now(),w=h-parseInt(n.getAttribute("data-tapTime")),y=n.id.replace("body-content-",""),f=w<300&&w>0,o=!m.has(y)&&n.getAttribute("data-liked")!=="true";f&&o&&(me(n),n.setAttribute("data-liked","true"),await g(r(y)),n.setAttribute("data-liked","false")),n.setAttribute("data-tapTime",h)};return{init:()=>{p=new Map,m=H("likes")},love:g,tapTap:c,getButtonLike:r,addListener:n=>{let h=new AbortController,w=document.getElementById(`body-content-${n}`);w.addEventListener("touchend",()=>c(w),{signal:h.signal}),p.set(n,h)},removeListener:n=>{let h=p.get(n);h&&(h.abort(),p.delete(n))}}})();var V=(()=>{let m=10,p=0,g=0,r=null,c=null,b=null,T=null,E=null,n=q=>{m=Number(q)},h=()=>m,w=()=>p,y=()=>g,f=()=>c.classList.contains("disabled")?null:c.classList.add("disabled"),o=()=>c.classList.contains("disabled")?c.classList.remove("disabled"):null,v=()=>b.classList.contains("disabled")?null:b.classList.add("disabled"),B=()=>b.classList.contains("disabled")?b.classList.remove("disabled"):null,i=q=>{v(),f();let l=u.disableButton(q,u.loader.replace("ms-0 me-1","mx-1"),!0),t=()=>{E.addEventListener("comment.done",()=>l.restore(),{once:!0}),E.addEventListener("comment.result",()=>E.scrollIntoView(),{once:!0}),E.dispatchEvent(new Event("comment.show"))};return{next:()=>{p+=m,q.innerHTML="Next"+q.innerHTML,t()},prev:()=>{p-=m,q.innerHTML=q.innerHTML+"Prev",t()}}};return{init:()=>{T=document.getElementById("pagination"),T.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page"></span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,E=document.getElementById("comments"),r=document.getElementById("page"),c=document.getElementById("previous"),b=document.getElementById("next")},setPer:n,getPer:h,getNext:w,reset:()=>p===0?!1:(p=0,v(),f(),!0),setTotal:q=>{if(g=Number(q),g<=m&&p===0){T.classList.add("d-none");return}let l=p/m+1,t=Math.ceil(g/m);if(r.innerText=`${l} / ${t}`,p>0&&o(),l>=t){v();return}B(),T.classList.contains("d-none")&&T.classList.remove("d-none")},geTotal:y,previous:q=>i(q).prev(),next:q=>i(q).next()}})();var se=(()=>{let m=null,p=null,g=null,r=null,c=null,b=[],T=()=>`<div class="text-center p-4 mx-0 mt-0 mb-3 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">${J.on("id","\u{1F4E2} Yuk, share undangan ini biar makin rame komentarnya! \u{1F389}").on("en","\u{1F4E2} Let's share this invitation to get more comments! \u{1F389}").get()}</p></div>`,E=(l,t)=>{document.querySelector(`[data-button-action="${l}"]`).childNodes.forEach(e=>{e.disabled=t})},n=l=>{E(l,!1),document.getElementById(`inner-${l}`).remove()},h=l=>{let t=l.getAttribute("data-uuids").split(","),e=l.getAttribute("data-show")==="true",d=l.getAttribute("data-uuid");e?(l.setAttribute("data-show","false"),l.innerText=`Show replies (${t.length})`,r.set("show",r.get("show").filter($=>$!==d))):(l.setAttribute("data-show","true"),l.innerText="Hide replies",r.set("show",r.get("show").concat([d])));for(let $ of t){r.set("hidden",r.get("hidden").map(C=>(C.uuid===$&&(C.show=!e),C)));let A=document.getElementById($).classList;e?A.add("d-none"):A.remove("d-none")}},w=(l,t)=>{let e=document.getElementById(`content-${t}`),d=u.base64Decode(e.getAttribute("data-comment")),$=l.getAttribute("data-show")==="false";u.safeInnerHTML(e,$?d:d.slice(0,G.maxCommentLength)+"..."),l.innerText=$?"Sebagian":"Selengkapnya",l.setAttribute("data-show",$?"true":"false")},y=async l=>{if(!S.isAdmin()||(l.comments&&await Promise.all(l.comments.map(e=>y(e))),l.ip===void 0||l.user_agent===void 0||l.is_admin))return;let t=(e,d,$)=>{u.safeInnerHTML(document.getElementById(`ip-${u.escapeHtml(e)}`),`<i class="fa-solid fa-location-dot me-1"></i>${u.escapeHtml(d)} <strong>${u.escapeHtml($)}</strong>`)};if(g.has(l.ip)){t(l.uuid,l.ip,g.get(l.ip));return}await P(j,`https://freeipapi.com/api/json/${l.ip}`).default(Y).then(e=>e.json()).then(e=>{let d=e.cityName+" - "+e.regionName;e.cityName==="-"&&e.regionName==="-"&&(d="localhost"),g.set(l.ip,d),t(l.uuid,l.ip,d)}).catch(e=>t(l.uuid,l.ip,e.message))},f=(l,t=[])=>(l.forEach(e=>{t.find(d=>d.uuid===e.uuid)||t.push(D.commentShowMore(e.uuid)),e.comments&&e.comments.length>0&&f(e.comments,t)}),t),o=()=>{for(let l of b)X.removeListener(l);return c.getAttribute("data-loading")==="false"&&(c.setAttribute("data-loading","true"),c.innerHTML=G.renderLoading().repeat(V.getPer())),P(j,`/api/v2/comment?per=${V.getPer()}&next=${V.getNext()}&lang=${J.getLanguage()}`).token(S.getToken()).send(D.getCommentsResponseV2).then(async l=>{c.setAttribute("data-loading","false");for(let e of b)await O.remove(e);if(l.data.lists.length===0)return c.innerHTML=T(),l;b=f(l.data.lists).map(e=>e.uuid),r.set("hidden",f(l.data.lists,r.get("hidden")));let t=await G.renderContentMany(l.data.lists);l.data.lists.length<V.getPer()&&(t+=T()),u.safeInnerHTML(c,t);for(let e of b)X.addListener(e);return l}).then(async l=>(c.dispatchEvent(new Event("comment.result")),l.data.lists.length>0&&await Promise.all(l.data.lists.map(t=>y(t))),V.setTotal(l.data.count),c.dispatchEvent(new Event("comment.done")),l))};return{gif:O,like:X,pagination:V,init:()=>{O.init(),X.init(),G.init(),V.init(),c=document.getElementById("comments"),c.addEventListener("comment.show",o),m=H("owns"),p=H("user"),g=H("tracker"),r=H("comment"),r.has("hidden")||r.set("hidden",[]),r.has("show")||r.set("show",[])},send:async l=>{let t=l.getAttribute("data-uuid"),e=document.getElementById("form-name"),d=e.value;if(S.isAdmin()&&(d=p.get("name")),d.length===0){alert("Name cannot be empty."),t&&e.scrollIntoView({block:"center"});return}let $=document.getElementById("form-presence");if(!t&&$&&$.value==="0"){alert("Please select your attendance status.");return}let A=O.isOpen(t||O.default),C=O.getResultId(t||O.default),z=O.buttonCancel(t);if(A&&!C){alert("Gif cannot be empty.");return}A&&C&&z.hide();let s=document.getElementById(`form-${t?`inner-${t}`:"comment"}`);if(!A&&s.value?.trim().length===0){alert("Comments cannot be empty.");return}!t&&e&&!S.isAdmin()&&(e.disabled=!0),!S.isAdmin()&&$&&$.value!=="0"&&($.disabled=!0),s&&(s.disabled=!0);let a=document.querySelector(`[onclick="undangan.comment.cancel(this, '${t}')"]`);a&&(a.disabled=!0);let k=u.disableButton(l),_=$?$.value==="1":!0;if(!S.isAdmin()){let I=H("information");I.set("name",d),t||I.set("presence",_)}let M=await P(Q,`/api/comment?lang=${J.getLanguage()}`).token(S.getToken()).body(D.postCommentRequest(t,d,_,A?null:s.value,C)).send(D.getCommentResponse).then(I=>I,()=>null);if(e&&(e.disabled=!1),s&&(s.disabled=!1),a&&(a.disabled=!1),$&&($.disabled=!1),A&&C&&z.show(),k.restore(),!(!M||M.code!==ne)){if(m.set(M.data.uuid,M.data.own),s&&(s.value=null),A&&C&&z.click(),!t){if(V.reset()){await o(),c.scrollIntoView();return}V.setTotal(V.geTotal()+1),c.children.length===V.getPer()&&c.lastElementChild.remove(),M.data.is_admin=S.isAdmin();let I=await G.renderContentMany([M.data]);c.insertAdjacentHTML("afterbegin",I),c.scrollIntoView()}if(t){r.set("hidden",r.get("hidden").concat([D.commentShowMore(M.data.uuid,!0)])),r.set("show",r.get("show").concat([t])),n(t),M.data.is_admin=S.isAdmin(),document.getElementById(`reply-content-${t}`).insertAdjacentHTML("beforeend",await G.renderContentSingle(M.data));let I=document.getElementById(`button-${t}`).querySelector("a"),N=[M.data.uuid];I&&(I.getAttribute("data-show")==="false"&&h(I),I.remove());let F=document.createRange().createContextualFragment(G.renderReadMore(t,I?I.getAttribute("data-uuids").split(",").concat(N):N)),R=X.getButtonLike(t);R.parentNode.insertBefore(F,R)}X.addListener(M.data.uuid),b.push(M.data.uuid)}},edit:async l=>{let t=l.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;E(t,!0);let e=u.disableButton(l);await P(j,"/api/comment/"+t).token(S.getToken()).send(D.commentResponse).then(async d=>{if(d.code!==W)return d;d.data.gif_url&&await O.remove(t);let $=document.getElementById(t).getAttribute("data-parent")==="true"&&!S.isAdmin();if(document.getElementById(`button-${t}`).insertAdjacentElement("afterend",G.renderEdit(t,d.data.presence,$,!!d.data.gif_url)),d.data.gif_url)return O.onOpen(t,()=>{O.removeGifSearch(t),O.removeButtonBack(t)}),O.open(t);let A=document.getElementById(`form-inner-${t}`);return A.value=d.data.comment,A.setAttribute("data-original",u.base64Encode(d.data.comment)),d}),e.restore(!0)},reply:async l=>{let t=l.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;E(t,!0);let e=u.disableButton(l);await O.remove(t),O.onOpen(t,()=>O.removeGifSearch(t)),e.restore(!0),document.getElementById(`button-${t}`).insertAdjacentElement("afterend",G.renderReply(t))},remove:async l=>{if(!confirm("Are you sure?"))return;let t=l.getAttribute("data-uuid");S.isAdmin()&&m.set(t,l.getAttribute("data-own")),E(t,!0);let e=u.disableButton(l),d=X.getButtonLike(t);if(d.disabled=!0,!await P(ie,"/api/comment/"+m.get(t)).token(S.getToken()).send(D.statusResponse).then(A=>A.data.status,()=>!1)){e.restore(),d.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(A=>{let C=A.getAttribute("data-uuids").split(",");if(C.find(z=>z===t)){let z=C.filter(s=>s!==t).join(",");z.length===0?A.remove():A.setAttribute("data-uuids",z)}}),m.unset(t),document.getElementById(t).remove(),c.children.length===0&&(c.innerHTML=T())},update:async l=>{let t=l.getAttribute("data-uuid"),e=!1,d=document.getElementById(`form-inner-presence-${t}`);d&&(d.disabled=!0,e=d.value==="1");let $=!1,A=document.getElementById(`badge-${t}`);A&&($=A.getAttribute("data-is-presence")==="true");let C=O.isOpen(t),z=O.getResultId(t),s=O.buttonCancel(t);if(C&&!z){alert("Gif cannot be empty.");return}C&&z&&s.hide();let a=document.getElementById(`form-inner-${t}`);if(t&&!C&&u.base64Encode(a.value)===a.getAttribute("data-original")&&$===e){n(t);return}if(!C&&a.value?.trim().length===0){alert("Comments cannot be empty.");return}a&&(a.disabled=!0);let k=document.querySelector(`[onclick="undangan.comment.cancel(this, '${t}')"]`);k&&(k.disabled=!0);let _=u.disableButton(l),M=await P(te,`/api/comment/${m.get(t)}?lang=${J.getLanguage()}`).token(S.getToken()).body(D.updateCommentRequest(d?e:null,C?null:a.value,z)).send(D.statusResponse).then(I=>I.data.status,()=>!1);if(a&&(a.disabled=!1),k&&(k.disabled=!1),d&&(d.disabled=!1),_.restore(),C&&z&&s.show(),!!M){if(C&&z&&(document.getElementById(`img-gif-${t}`).src=document.getElementById(`gif-result-${t}`)?.querySelector("img").src,s.click()),n(t),!C){let I=document.querySelector(`[onclick="undangan.comment.showMore(this, '${t}')"]`),N=G.convertMarkdownToHTML(u.escapeHtml(a.value)),F=document.getElementById(`content-${t}`);N.length>G.maxCommentLength?(u.safeInnerHTML(F,I?.getAttribute("data-show")==="false"?N.slice(0,G.maxCommentLength)+"...":N),F.setAttribute("data-comment",u.base64Encode(N)),I?.classList.replace("d-none","d-block")):(u.safeInnerHTML(F,N),F.removeAttribute("data-comment"),I?.classList.replace("d-block","d-none"))}d&&(document.getElementById("form-presence").value=e?"1":"2",H("information").set("presence",e)),!(!d||!A)&&(A.classList.toggle("fa-circle-xmark",!e),A.classList.toggle("text-danger",!e),A.classList.toggle("fa-circle-check",e),A.classList.toggle("text-success",e))}},cancel:async(l,t)=>{let e=document.getElementById(`form-inner-presence-${t}`),d=e?e.value==="1":!1,$=document.getElementById(`badge-${t}`),A=$&&m.has(t)&&e?$.getAttribute("data-is-presence")==="true":!1;if(u.disableButton(l),O.isOpen(t)&&(!O.getResultId(t)&&A===d||confirm("Are you sure?"))){await O.remove(t),n(t);return}let C=document.getElementById(`form-inner-${t}`);(C.value.length===0||u.base64Encode(C.value)===C.getAttribute("data-original")&&A===d||confirm("Are you sure?"))&&n(t)},show:o,showMore:w,showOrHide:h}})();var ue=(()=>{let m=()=>Z.getDetailUser().then(i=>{u.safeInnerHTML(document.getElementById("dashboard-name"),`${u.escapeHtml(i.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`),document.getElementById("dashboard-email").textContent=i.data.email,document.getElementById("dashboard-accesskey").value=i.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",i.data.access_key),document.getElementById("form-name").value=u.escapeHtml(i.data.name),document.getElementById("filterBadWord").checked=!!i.data.is_filter,document.getElementById("replyComment").checked=!!i.data.can_reply,document.getElementById("editComment").checked=!!i.data.can_edit,document.getElementById("deleteComment").checked=!!i.data.can_delete,document.getElementById("dashboard-tenorkey").value=i.data.tenor_key,H("config").set("tenor_key",i.data.tenor_key)}),p=()=>{P(j,"/api/stats").token(S.getToken()).send().then(i=>{document.getElementById("count-comment").textContent=String(i.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").textContent=String(i.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").textContent=String(i.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").textContent=String(i.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")})},g=async i=>{let x=u.disableCheckbox(i);await P(K,"/api/user").token(S.getToken()).body({filter:!!i.checked}).send(),x.restore()},r=async i=>{let x=u.disableCheckbox(i);await P(K,"/api/user").token(S.getToken()).body({can_reply:!!i.checked}).send(),x.restore()},c=async i=>{let x=u.disableCheckbox(i);await P(K,"/api/user").token(S.getToken()).body({can_edit:!!i.checked}).send(),x.restore()},b=async i=>{let x=u.disableCheckbox(i);await P(K,"/api/user").token(S.getToken()).body({can_delete:!!i.checked}).send(),x.restore()},T=async i=>{let x=u.disableButton(i),L=document.getElementById("dashboard-tenorkey");L.disabled=!0,await P(K,"/api/user").token(S.getToken()).body({tenor_key:L.value.length?L.value:null}).send().then(()=>alert(`success ${L.value.length?"add":"remove"} tenor key`)),L.disabled=!1,x.restore()},E=async i=>{if(!confirm("Are you sure?"))return;let x=u.disableButton(i);await P(te,"/api/key").token(S.getToken()).send(D.statusResponse).then(L=>{L.data.status&&m()}),x.restore()},n=async i=>{let x=document.getElementById("old_password"),L=document.getElementById("new_password");if(x.value.length===0||L.value.length===0){alert("Password cannot be empty");return}x.disabled=!0,L.disabled=!0;let U=u.disableButton(i),q=await P(K,"/api/user").token(S.getToken()).body({old_password:x.value,new_password:L.value}).send(D.statusResponse).then(l=>l.data.status,()=>!1);U.restore(!0),x.disabled=!1,L.disabled=!1,q&&(x.value=null,L.value=null,alert("Success change password"))},h=async i=>{let x=document.getElementById("form-name");if(x.value.length===0){alert("Name cannot be empty");return}x.disabled=!0;let L=u.disableButton(i),U=await P(K,"/api/user").token(S.getToken()).body({name:x.value}).send(D.statusResponse).then(q=>q.data.status,()=>!1);x.disabled=!1,L.restore(!0),U&&(m(),alert("Success change name"))},w=async i=>{let x=u.disableButton(i);await P(j,"/api/download").token(S.getToken()).download(),x.restore()},y=()=>{let i=document.getElementById("button-change-name");i.disabled&&(i.disabled=!1)},f=()=>{let i=document.getElementById("button-change-password"),x=document.getElementById("old_password");i.disabled&&x.value.length!==0&&(i.disabled=!1)},o=()=>{confirm("Are you sure?")&&Z.clearSession()},v=()=>{J.init(),J.setDefault("en"),ce.init(),oe.spyTop();let i=async()=>{await m(),p(),se.init(),se.show()};document.addEventListener("hidden.bs.modal",i);try{let x=window.location.href.split("?k=");x.length>1&&x[1].length>=1&&(S.setToken(x[1]),window.history.replaceState({},document.title,x[0]));let L=S.decode()?.exp;if(!L||L<Date.now()/1e3)throw new Error("Invalid token");i()}catch{Z.clearSession()}};return{init:()=>(Z.init(),oe.init(),S.init(),S.isAdmin()||(H("owns").clear(),H("likes").clear(),H("config").clear(),H("comment").clear(),H("session").clear(),H("information").clear()),window.addEventListener("DOMContentLoaded",v),{util:u,theme:oe,comment:se,admin:{auth:Z,navbar:le,logout:o,tenor:T,download:w,regenerate:E,editComment:c,replyComment:r,deleteComment:b,changeName:h,changePassword:n,changeFilterBadWord:g,enableButtonName:y,enableButtonPassword:f}})}})();(m=>{m.undangan=ue.init()})(window);})();
